<section class="tab-intro">
    <h2>How to Use This Dashboard</h2>
    <p>
        This dashboard provides interactive visualizations of the AOP-Wiki database evolution over time.
        Toggle between absolute values (total counts) and deltas (changes since previous release) using the button below.
        Use the navigation buttons to jump to different sections.
    </p>
</section>

<!-- Navigation Buttons -->
<div style="text-align:center; margin:20px;">
    <button class="nav-button" onclick="document.getElementById('main-trends').scrollIntoView({behavior:'smooth'});">Main Trends</button>
    <button class="nav-button" onclick="document.getElementById('network-connectivity').scrollIntoView({behavior:'smooth'});">Connectivity</button>
    <button class="nav-button" onclick="document.getElementById('authors').scrollIntoView({behavior:'smooth'});">Authors & Lifetime</button>
    <button class="nav-button" onclick="document.getElementById('ke-components').scrollIntoView({behavior:'smooth'});">KE Components</button>
</div>

<!-- Global Toggle -->
<div style="text-align:center; padding: 20px;">
    <button id="toggle-delta" class="toggle-button">Switch to Delta Mode</button>
</div>

<section class="section-block" id="main-trends">
    <!-- Main trends -->
    <h2 class="section-header">Main Entity Trends</h2>
    <div class="plot-grid">
    <div class="plot-box" id="main-trends">
        <div class="plot-header">
            <h3>AOP Entity Counts</h3>
            <div style="display: flex; gap: 10px; align-items: center;">
                <a href="/download/main_graph_absolute" class="download-button" title="Download Absolute CSV data">CSV (Abs)</a>
                <a href="/download/main_graph_delta" class="download-button" title="Download Delta CSV data">CSV (Δ)</a>
                <label><input type="checkbox" class="plot-toggle"> Show Deltas</label>
            </div>
        </div>
        <p class="plot-description">
            Tracks the total number of AOPs, Key Events (KEs), Key Event Relationships (KERs), 
            and Stressors over time.
        </p>
        <div class="abs">
            <div class="lazy-plot" data-plot-name="graph_main_abs">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
        <div class="delta" style="display:none;">
            <div class="lazy-plot" data-plot-name="graph_main_delta">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
    </div>



    <!-- AOP Property Presence -->
    <div class="plot-box full-width" id="aop-property-presence">
        <div class="plot-header">
            <h3>AOP Property Presence Over Time</h3>
            <label><input type="checkbox" class="plot-toggle"> Show Percentage</label>
        </div>
        <p class="plot-description">
            Shows how many AOPs contain each property over time. 
            Properties always present (100%) are excluded for clarity.
        </p>
        <div class="abs">
            <div class="lazy-plot" data-plot-name="graph_prop_abs">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
        <div class="delta" style="display:none;">
            <div class="lazy-plot" data-plot-name="graph_prop_pct">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
    </div>

    <!-- AOP Property Presence - Unique Colors -->
    <div class="plot-box full-width" id="aop-property-presence-unique">
        <div class="plot-header">
            <h3>AOP Property Presence Over Time - Unique Colors</h3>
            <div style="display: flex; gap: 10px; align-items: center;">
                <a href="/download/aop_property_presence_unique_absolute" class="download-button" title="Download Absolute Count CSV">CSV (Abs)</a>
                <a href="/download/aop_property_presence_unique_percentage" class="download-button" title="Download Percentage CSV">CSV (%)</a>
                <label><input type="checkbox" class="plot-toggle"> Show Percentage</label>
            </div>
        </div>
        <p class="plot-description">
            Same AOP property presence trends with unique colors for each property line instead of repeating colors.
            Larger panel for better visualization of all property trends.
        </p>
        <div class="abs">
            <div class="lazy-plot" data-plot-name="graph_prop_unique_abs">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
        <div class="delta" style="display:none;">
            <div class="lazy-plot" data-plot-name="graph_prop_unique_pct">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
    </div>
    </div>
</section>

<section class="section-block" id="network-connectivity">
    <!-- Average KEs/KERs -->
    <h2 class="section-header">AOP Connectivity and Network Structure</h2>
    <div class="plot-grid">
    <div class="plot-box" id="avg-per-aop">
        <div class="plot-header">
            <h3>Average KEs and KERs per AOP</h3>
            <label><input type="checkbox" class="plot-toggle"> Show Deltas</label>
        </div>
        <p class="plot-description">
            Shows how densely connected each AOP is on average, 
            measured by the number of Key Events and Key Event Relationships per AOP.
        </p>
        <div class="abs">
            <div class="lazy-plot" data-plot-name="graph_avg_abs">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
        <div class="delta" style="display:none;">
            <div class="lazy-plot" data-plot-name="graph_avg_delta">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
    </div>
    <!-- AOP Network Density -->
    <div class="plot-box" id="density">
        <div class="plot-header">
            <h3>AOP Network Density</h3>
        </div>
        <p class="plot-description">
            Shows how densely connected the KE-KER graph is over time,
            calculated as the ratio of edges to possible connections between nodes.
        </p>
        <div class="lazy-plot" data-plot-name="graph_density">
            <!-- Plot will be loaded here via JavaScript -->
        </div>
    </div>

    </div>
</section>

<section class="section-block" id="authors">
    <!-- Authors -->
    <h2 id="authors" class="section-header">Authors and AOP Lifetime</h2>
    <div class="plot-grid">
    <div class="plot-box" id="authors">
        <div class="plot-header">
            <h3>Authors of AOPs</h3>
            <label><input type="checkbox" class="plot-toggle"> Show Deltas</label>
        </div>
        <p class="plot-description">
            Tracks the number of unique authors contributing to AOPs over time.
        </p>
        <div class="abs">
            <div class="lazy-plot" data-plot-name="graph_authors_abs">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
        <div class="delta" style="display:none;">
            <div class="lazy-plot" data-plot-name="graph_authors_delta">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
    </div>

    <!-- AOPs Created -->
    <div class="plot-box" id="lifetime">
        <div class="plot-header">
            <h3>AOPs Created Over Time</h3>
        </div>
        <p class="plot-description">
            Number of unique AOPs first created in each year.
        </p>
        <div class="lazy-plot" data-plot-name="graph_created">
            <!-- Plot will be loaded here via JavaScript -->
        </div>
    </div>

    <!-- AOPs Modified -->
    <div class="plot-box">
        <div class="plot-header">
            <h3>AOPs Modified Over Time</h3>
        </div>
        <p class="plot-description">
            Tracks how many unique AOPs were last modified in each year.
        </p>
        <div class="lazy-plot" data-plot-name="graph_modified">
            <!-- Plot will be loaded here via JavaScript -->
        </div>
    </div>

    <!-- Scatter plot -->
    <div class="plot-box">
        <div class="plot-header">
            <h3>AOP Creation vs Modification</h3>
        </div>
        <p class="plot-description">
            Scatter plot showing when each AOP was created versus when it was last updated.
        </p>
        <div class="lazy-plot" data-plot-name="graph_scatter">
            <!-- Plot will be loaded here via JavaScript -->
        </div>
    </div>
    </div>
</section>

<section class="section-block" id="ke-components">
    <!-- KE Components and Biological Annotations -->
    <h2 class="section-header">KE Component Annotations</h2>
    <div class="plot-grid">
    <div class="plot-box" id="ke-components">
        <div class="plot-header">
            <h3>KE Component Annotations</h3>
            <label><input type="checkbox" class="plot-toggle"> Show Deltas</label>
        </div>
        <p class="plot-description">
            Tracks how many Key Event annotations include Process, Object, and Action elements over time.
        </p>
        <div class="abs">
            <div class="lazy-plot" data-plot-name="graph_components_abs">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
        <div class="delta" style="display:none;">
            <div class="lazy-plot" data-plot-name="graph_components_delta">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
    </div>

    <div class="plot-box" id="ke-components-pct">
        <div class="plot-header">
            <h3>KE Components as % of Total KEs</h3>
            <label><input type="checkbox" class="plot-toggle"> Show Deltas</label>
        </div>
        <p class="plot-description">
            Shows how many Key Events have Process, Object, and Action annotations as a percentage of all KEs per version.
        </p>
        <div class="abs">
            <div class="lazy-plot" data-plot-name="graph_components_pct_abs">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
        <div class="delta" style="display:none;">
            <div class="lazy-plot" data-plot-name="graph_components_pct_delta">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
    </div>

    <div class="plot-box" id="unique-ke-components">
        <div class="plot-header">
            <h3>Unique KE Component Annotations</h3>
            <label><input type="checkbox" class="plot-toggle"> Show Deltas</label>
        </div>
        <p class="plot-description">
            Tracks the total number of unique Process, Object, and Action annotations used in Key Events over time.
        </p>
        <div class="abs">
            <div class="lazy-plot" data-plot-name="graph_unique_abs">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
        <div class="delta" style="display:none;">
            <div class="lazy-plot" data-plot-name="graph_unique_delta">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
    </div>

    <div class="plot-box" id="bio-processes">
        <div class="plot-header">
            <h3>Biological Process Annotations</h3>
            <label><input type="checkbox" class="plot-toggle"> Show Deltas</label>
        </div>
        <p class="plot-description">
            Shows KE annotations with biological processes grouped by ontology.
        </p>
        <div class="abs">
            <div class="lazy-plot" data-plot-name="graph_bio_processes_abs">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
        <div class="delta" style="display:none;">
            <div class="lazy-plot" data-plot-name="graph_bio_processes_delta">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
    </div>

    <div class="plot-box" id="bio-objects">
        <div class="plot-header">
            <h3>Biological Object Annotations</h3>
            <label><input type="checkbox" class="plot-toggle"> Show Deltas</label>
        </div>
        <p class="plot-description">
            Shows KE annotations with biological objects grouped by ontology.
        </p>
        <div class="abs">
            <div class="lazy-plot" data-plot-name="graph_bio_objects_abs">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
        <div class="delta" style="display:none;">
            <div class="lazy-plot" data-plot-name="graph_bio_objects_delta">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
    </div>

    <div class="plot-box" id="kes-by-kec">
        <div class="plot-header">
            <h3>KEs by Number of KECs</h3>
            <label><input type="checkbox" class="plot-toggle"> Show Deltas</label>
        </div>
        <p class="plot-description">
            Tracks how many Key Events contain a specific number of Key Event Components (KECs) 
            over time, showing annotation completeness.
        </p>
        <div class="abs">
            <div class="lazy-plot" data-plot-name="graph_kec_count_abs">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
        <div class="delta" style="display:none;">
            <div class="lazy-plot" data-plot-name="graph_kec_count_delta">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
    </div>

    </div>
</section>


<script>
document.querySelectorAll(".plot-toggle").forEach(toggle => {
    toggle.addEventListener("change", function() {
        const box = this.closest(".plot-box");
        const abs = box.querySelector(".abs");
        const delta = box.querySelector(".delta");
        if (abs && delta) {
            abs.style.display = this.checked ? "none" : "block";
            delta.style.display = this.checked ? "block" : "none";
        }
        window.dispatchEvent(new Event('resize'));
    });
});
</script>
<script>
    document.getElementById("toggle-delta").addEventListener("click", function () {
        const isDelta = this.classList.toggle("active");
        this.textContent = isDelta ? "Switch to Absolute Mode" : "Switch to Delta Mode";

        document.querySelectorAll(".plot-box").forEach(box => {
            const abs = box.querySelector(".abs");
            const delta = box.querySelector(".delta");
            const checkbox = box.querySelector(".plot-toggle");
            if (abs && delta) {
                abs.style.display = isDelta ? "none" : "block";
                delta.style.display = isDelta ? "block" : "none";
            }
            // ✅ Sync individual checkboxes
            if (checkbox) {
                checkbox.checked = isDelta;
            }
        });
        window.dispatchEvent(new Event('resize'));
    });
</script>
