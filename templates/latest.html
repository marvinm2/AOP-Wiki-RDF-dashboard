<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Database Snapshot - AOP-Wiki RDF Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/lazy-loading.css') }}">
    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
</head>

<body>
<header>
    <h1>Database Snapshot</h1>
    <p style="text-align:center; max-width:800px; margin:10px auto; color:white;">
        Key metrics and visualizations from the selected version of the AOP-Wiki database.
        Use the version selector below to compare different database snapshots over time.
    </p>
</header>

<!-- Navigation Bar -->
<div class="page-navigation">
    <a href="/" class="nav-link">← Back to Home</a>
    <a href="/trends" class="nav-link">Historical Trends</a>
</div>

<!-- Version Selector -->
<div class="version-selector-container">
    <label for="version-selector" class="version-selector-label">
        <span class="label-icon">📅</span>
        View Database Version:
    </label>
    <select id="version-selector" class="version-selector">
        <option value="">Loading versions...</option>
    </select>
</div>

<!-- Version Banner (shown when historical version selected) -->
<div id="version-banner" class="version-banner" style="display: none;">
    <div class="version-banner-content">
        <span class="version-banner-icon">ℹ️</span>
        <span class="version-banner-text">
            Viewing historical version: <strong class="version-name"></strong>
        </span>
        <button class="version-banner-reset" onclick="document.getElementById('version-selector').value = ''; document.getElementById('version-selector').dispatchEvent(new Event('change'));">
            Return to Current Version
        </button>
    </div>
</div>

<section class="tab-intro">
    <h2>Current Database State</h2>
    <p>
        This section displays key metrics and visualizations from the most recent version of the AOP-Wiki database.
        These charts provide a snapshot of the current state of the knowledge base, showing entity counts,
        component distributions, and data quality metrics.
    </p>
    <ul>
        <li><b>Current State:</b> View entity counts and database composition</li>
        <li><b>Network Analysis:</b> Understand AOP connectivity and structural relationships</li>
        <li><b>Data Quality:</b> Assess annotation completeness and ontology usage patterns</li>
    </ul>
</section>

<!-- Bulk Download Section -->
<div style="text-align:center; margin:20px; padding:15px; background-color: #f9f9f9; border-radius: 8px;">
    <h3 style="margin-top:0; color:#29235C;">📦 Bulk Download</h3>
    <p style="font-size:14px; color:#666; margin:10px 0;">Download all plots at once in multiple formats</p>
    <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
        <a href="/download/bulk?category=latest-all&formats=csv,png,svg" class="nav-button" style="text-decoration:none; display:inline-block;">
            📥 Download All (CSV + PNG + SVG)
        </a>
        <a href="/download/bulk?category=latest-all&formats=csv" class="nav-button" style="text-decoration:none; display:inline-block;">
            📄 CSV Only
        </a>
        <a href="/download/bulk?category=latest-all&formats=png" class="nav-button" style="text-decoration:none; display:inline-block;">
            🖼️ PNG Only
        </a>
    </div>
</div>

<!-- Navigation Buttons -->
<div style="text-align:center; margin:20px;">
    <button class="nav-button" onclick="document.getElementById('database-state').scrollIntoView({behavior:'smooth'});">Database State</button>
    <button class="nav-button" onclick="document.getElementById('network-analysis').scrollIntoView({behavior:'smooth'});">Network Analysis</button>
    <button class="nav-button" onclick="document.getElementById('ke-analysis').scrollIntoView({behavior:'smooth'});">Key Event Analysis</button>
    <button class="nav-button" onclick="document.getElementById('data-quality').scrollIntoView({behavior:'smooth'});">Data Quality</button>
</div>

<section class="section-block" id="database-state">
    <h2 class="section-header">Current Database State</h2>
    <div class="plot-grid">
        <div class="plot-box">
            <div class="plot-header">
                <h3>Entity Counts</h3>
                <div class="download-dropdown">
                    <button class="download-button dropdown-toggle">Download ▼</button>
                    <div class="dropdown-menu">
                        <a href="/download/latest_entity_counts?format=csv" class="dropdown-item">📄 CSV</a>
                        <a href="/download/latest_entity_counts?format=png" class="dropdown-item">🖼️ PNG</a>
                        <a href="/download/latest_entity_counts?format=svg" class="dropdown-item">📐 SVG</a>
                    </div>
                </div>
            </div>
            <p class="plot-description">
                Total number of each entity type and unique authors in the latest version of the AOP-Wiki database.
            </p>
            <div class="lazy-plot" data-plot-name="latest_entity_counts">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
    </div>
</section>

<section class="section-block" id="network-analysis">
    <h2 class="section-header">Network Analysis</h2>
    <div class="plot-grid">
        <div class="plot-box">
            <div class="plot-header">
                <h3>AOP Connectivity</h3>
                <div class="download-dropdown">
                    <button class="download-button dropdown-toggle">Download ▼</button>
                    <div class="dropdown-menu">
                        <a href="/download/latest_aop_connectivity?format=csv" class="dropdown-item">📄 CSV</a>
                        <a href="/download/latest_aop_connectivity?format=png" class="dropdown-item">🖼️ PNG</a>
                        <a href="/download/latest_aop_connectivity?format=svg" class="dropdown-item">📐 SVG</a>
                    </div>
                </div>
            </div>
            <p class="plot-description">
                Analysis of AOP connectivity based on shared Key Events. Connected AOPs share at least one Key Event with other AOPs, while isolated AOPs have unique Key Events.
            </p>
            <div class="lazy-plot" data-plot-name="latest_aop_connectivity">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
        <div class="plot-box">
            <div class="plot-header">
                <h3>Average Components per AOP</h3>
                <div class="download-dropdown">
                    <button class="download-button dropdown-toggle">Download ▼</button>
                    <div class="dropdown-menu">
                        <a href="/download/latest_avg_per_aop?format=csv" class="dropdown-item">📄 CSV</a>
                        <a href="/download/latest_avg_per_aop?format=png" class="dropdown-item">🖼️ PNG</a>
                        <a href="/download/latest_avg_per_aop?format=svg" class="dropdown-item">📐 SVG</a>
                    </div>
                </div>
            </div>
            <p class="plot-description">
                Average number of Key Events and Key Event Relationships per AOP in the current database.
            </p>
            <div class="lazy-plot" data-plot-name="latest_avg_per_aop">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
    </div>
</section>

<section class="section-block" id="ke-analysis">
    <h2 class="section-header">Key Event Analysis</h2>
    <div class="plot-grid">
        <div class="plot-box">
            <div class="plot-header">
                <h3>KE Component Distribution</h3>
                <div class="download-dropdown">
                    <button class="download-button dropdown-toggle">Download ▼</button>
                    <div class="dropdown-menu">
                        <a href="/download/latest_ke_components?format=csv" class="dropdown-item">📄 CSV</a>
                        <a href="/download/latest_ke_components?format=png" class="dropdown-item">🖼️ PNG</a>
                        <a href="/download/latest_ke_components?format=svg" class="dropdown-item">📐 SVG</a>
                    </div>
                </div>
            </div>
            <p class="plot-description">
                Distribution of Key Event component annotations (Process, Object, Action) in the current database.
            </p>
            <div class="lazy-plot" data-plot-name="latest_ke_components">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
        <div class="plot-box">
            <div class="plot-header">
                <h3>KE Annotation Depth</h3>
                <div class="download-dropdown">
                    <button class="download-button dropdown-toggle">Download ▼</button>
                    <div class="dropdown-menu">
                        <a href="/download/latest_ke_annotation_depth?format=csv" class="dropdown-item">📄 CSV</a>
                        <a href="/download/latest_ke_annotation_depth?format=png" class="dropdown-item">🖼️ PNG</a>
                        <a href="/download/latest_ke_annotation_depth?format=svg" class="dropdown-item">📐 SVG</a>
                    </div>
                </div>
            </div>
            <p class="plot-description">
                Distribution of annotation depth for Key Events, showing how thoroughly they are documented.
            </p>
            <div class="lazy-plot" data-plot-name="latest_ke_annotation_depth">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
    </div>
</section>

<section class="section-block" id="data-quality">
    <h2 class="section-header">Data Quality & Completeness</h2>
    <div class="plot-grid">
        <div class="plot-box full-width">
            <div class="plot-header">
                <h3>AOP Completeness</h3>
                <div class="download-dropdown">
                    <button class="download-button dropdown-toggle">Download ▼</button>
                    <div class="dropdown-menu">
                        <a href="/download/latest_aop_completeness?format=csv" class="dropdown-item">📄 CSV</a>
                        <a href="/download/latest_aop_completeness?format=png" class="dropdown-item">🖼️ PNG</a>
                        <a href="/download/latest_aop_completeness?format=svg" class="dropdown-item">📐 SVG</a>
                    </div>
                </div>
            </div>
            <p class="plot-description">
                Analysis of AOP data completeness showing the distribution of essential vs optional fields.
            </p>
            <div class="lazy-plot" data-plot-name="latest_aop_completeness">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
        <div class="plot-box">
            <div class="plot-header">
                <h3>Biological Process Usage</h3>
                <div class="download-dropdown">
                    <button class="download-button dropdown-toggle">Download ▼</button>
                    <div class="dropdown-menu">
                        <a href="/download/latest_process_usage?format=csv" class="dropdown-item">📄 CSV</a>
                        <a href="/download/latest_process_usage?format=png" class="dropdown-item">🖼️ PNG</a>
                        <a href="/download/latest_process_usage?format=svg" class="dropdown-item">📐 SVG</a>
                    </div>
                </div>
            </div>
            <p class="plot-description">
                Distribution of biological process ontology terms used in Key Event annotations.
            </p>
            <div class="lazy-plot" data-plot-name="latest_process_usage">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
        <div class="plot-box">
            <div class="plot-header">
                <h3>Biological Object Usage</h3>
                <div class="download-dropdown">
                    <button class="download-button dropdown-toggle">Download ▼</button>
                    <div class="dropdown-menu">
                        <a href="/download/latest_object_usage?format=csv" class="dropdown-item">📄 CSV</a>
                        <a href="/download/latest_object_usage?format=png" class="dropdown-item">🖼️ PNG</a>
                        <a href="/download/latest_object_usage?format=svg" class="dropdown-item">📐 SVG</a>
                    </div>
                </div>
            </div>
            <p class="plot-description">
                Distribution of biological object ontology terms used in Key Event annotations.
            </p>
            <div class="lazy-plot" data-plot-name="latest_object_usage">
                <!-- Plot will be loaded here via JavaScript -->
            </div>
        </div>
    </div>
</section>

<footer>
    <div class="footer-content">
        AOP-Wiki RDF Monitoring Service — Built for VHP4Safety  |
        <a href="https://aopwiki.cloud.vhp4safety.nl" target="_blank">AOP-Wiki SPARQL Endpoint</a>  |
        <a href="https://github.com/marvinm2/AOP-Wiki-RDF-dashboard" target="_blank">GitHub Repository</a>
    </div>
</footer>

<script src="{{ url_for('static', filename='js/lazy-loading.js') }}"></script>
<script src="{{ url_for('static', filename='js/version-selector.js') }}"></script>
</body>
</html>